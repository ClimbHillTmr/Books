<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>数据科学入门</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles1.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos744274" class="calibre_"><span class="calibre6"><span class="bold"> 24.3　更加一般化的MapReduce </span></span></p><p class="calibre_">思考一下，前面例子中所有的单词计数代码是包括在 <tt class="calibre7">wc_mapper</tt> 和 <tt class="calibre7">wc_reducer</tt> 这两个函数中的。这意味着通过几个改变我们会得到一个更通用的框架（仍然是运行在单个机器上的）：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>def map_reduce(inputs, mapper, reducer):<br class="calibre12"/>    """runs MapReduce on the inputs using mapper and reducer"""<br class="calibre12"/>    collector = defaultdict(list)<br class="calibre12"/><br class="calibre12"/>    for input in inputs:<br class="calibre12"/>        for key, value in mapper(input):<br class="calibre12"/>            collector[key].append(value)<br class="calibre12"/><br class="calibre12"/>    return [output<br class="calibre12"/>            for key, values in collector.iteritems()<br class="calibre12"/>            for output in reducer(key,values)]<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><p class="calibre_15">然后我们可以通过下面的方法简单地完成单词计数：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>word_counts = map_reduce(documents, wc_mapper, wc_reducer)<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><p class="calibre_15">这为我们解决各种类型的问题提供了灵活性。</p><p class="calibre_">在继续讲解下面的内容之前，我们先观察一下 <tt class="calibre7">wc_reducer</tt> 函数，它仅仅是把对应于每一个键的值加起来。这种聚合是非常普遍的，值得把它抽象出来：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>def reduce_values_using(aggregation_fn, key, values):<br class="calibre12"/>    """reduces a key-values pair by applying aggregation_fn to the values"""<br class="calibre12"/>    yield (key, aggregation_fn(values))<br class="calibre12"/><br class="calibre12"/>def values_reducer(aggregation_fn):<br class="calibre12"/>    """turns a function (values -&gt; output) into a reducer<br class="calibre12"/>    that maps (key, values) -&gt; (key, output)"""<br class="calibre12"/>    return partial(reduce_values_using, aggregation_fn)<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><p class="calibre_15">在这之后我们就可以轻松创建以下内容：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>sum_reducer = values_reducer(sum)<br class="calibre12"/>max_reducer = values_reducer(max)<br class="calibre12"/>min_reducer = values_reducer(min)<br class="calibre12"/>count_distinct_reducer = values_reducer(lambda values: len(set(values)))<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><div class="mbp_pagebreak" id="calibre_pb_174"></div>
<div class="calibre5">本书由「<a href="https://epubw.com" class="calibre3">ePUBw.COM</a>」整理，<a href="https://epubw.com" class="calibre3">ePUBw.COM</a> 提供最新最全的优质电子书下载！！！</div></body></html>
