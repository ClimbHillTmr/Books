<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>数据科学入门</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles1.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos737910" class="calibre_"><span class="calibre6"><span class="bold"> 24.1　案例：单词计数 </span></span></p><p class="calibre_">DataSciencester 网站的用户数量已增长到了数百万！这对你的工作是极大的保障，但也使日常分析变得有点困难了。</p><p class="calibre_">比如，内容部门的副总想知道用户的状态更新都涉及什么内容。作为初步的尝试，你决定统计一下出现的单词的数量，这样你就可以准备一个关于出现频度最高的单词的报告。</p><p class="calibre_">当有几百个用户的时候这做起来很简单：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>def word_count_old(documents):<br class="calibre12"/>    """word count not using MapReduce"""<br class="calibre12"/>    return Counter(word<br class="calibre12"/>        for document in documents<br class="calibre12"/>        for word in tokenize(document))<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><p class="calibre_15">而数百万个用户的 <tt class="calibre7">documents</tt> 集合就变得很大，你的电脑都装不下。如果你能把它们纳入 MapReduce 模型处理，就可以使用你的引擎上已经部署的一些“大数据”架构。</p><p class="calibre_">首先，我们需要一个函数来把文档转化成一系列的键值对。我们希望输出的结果能按单词分组，这意味着键应该是单词。对每一个单词，我们只发送值 <tt class="calibre7">1</tt> 来表示这个键值对对应于单词出现一次：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>def wc_mapper(document):<br class="calibre12"/>    """for each word in the document, emit (word,1)"""<br class="calibre12"/>    for word in tokenize(document):<br class="calibre12"/>        yield (word, 1)<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><p class="calibre_15">先暂时跳过第二步，假设对某些词我们已经收集了所发送过的对应计数的列表。接下来生成我们所需要的这个词的全部计数：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>def wc_reducer(word, counts):<br class="calibre12"/>    """sum up the counts for a word"""<br class="calibre12"/>    yield (word, sum(counts))<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><p class="calibre_15">再返回步骤 2，现在我们需要收集来自 <tt class="calibre7">wc_mapper</tt> 的结果，再把它们传递给 <tt class="calibre7">wc_reducer</tt> 。让我们思考一下怎么在一台计算机上完成这件事：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>def word_count(documents):<br class="calibre12"/>    """count the words in the input documents using MapReduce"""<br class="calibre12"/><br class="calibre12"/>    # 存放分好组的值<br class="calibre12"/>    collector = defaultdict(list)<br class="calibre12"/><br class="calibre12"/>    for document in documents:<br class="calibre12"/>        for word, count in wc_mapper(document):<br class="calibre12"/>            collector[word].append(count)<br class="calibre12"/><br class="calibre12"/>    return [output<br class="calibre12"/>            for word, counts in collector.iteritems()<br class="calibre12"/>            for output in wc_reducer(word, counts)]<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><p class="calibre_15">假设我们有三个文档 <tt class="calibre7">["data science", "big data", "science fiction"]</tt> 。</p><p class="calibre_">然后把 <tt class="calibre7">wc_mapper</tt> 应用到第一个文档，产生两个键值对 <tt class="calibre7">("data", 1)</tt> 和 <tt class="calibre7">("science", 1)</tt> 。在处理完所有三个文档之后，列表 <tt class="calibre7">collector</tt> 会包含：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>{ "data" : [1, 1],<br class="calibre12"/>  "science" : [1, 1],<br class="calibre12"/>  "big" : [1],<br class="calibre12"/>  "fiction" : [1] }<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><p class="calibre_15">然后 wc_reducer 函数生成了每个单词的计数：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>[("data", 2), ("science", 2), ("big", 1), ("fiction", 1)]<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><div class="mbp_pagebreak" id="calibre_pb_172"></div>
<div class="calibre5">本书由「<a href="https://epubw.com" class="calibre3">ePUBw.COM</a>」整理，<a href="https://epubw.com" class="calibre3">ePUBw.COM</a> 提供最新最全的优质电子书下载！！！</div></body></html>
