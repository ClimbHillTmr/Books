<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>数据科学入门</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles1.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos282434" class="calibre_"><span class="calibre6"><span class="bold"> 9.1　stdin和stdout </span></span></p><p class="calibre_">如果在命令行运行 Python 脚本，你可以用 <tt class="calibre7">sys.stdin</tt> 和 <tt class="calibre7">sys.stdout</tt> 以<span class="bold">管道</span> （pipe）方式传递数据。例如，以下脚本按行读入文本，然后划分出和一个正则表达式匹配的行：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/># egrep.py<br class="calibre12"/>import sys, re<br class="calibre12"/><br class="calibre12"/># sys.argv是命令行参数的列表<br class="calibre12"/># sys.argv[0]是程序自己的名字<br class="calibre12"/># sys.argv[1]会是在命令行上指定的正则表达式<br class="calibre12"/>regex = sys.argv[1]<br class="calibre12"/><br class="calibre12"/># 对传递到这个脚本中的每一个行<br class="calibre12"/>for line in sys.stdin:<br class="calibre12"/>    # 如果它匹配正则表达式，则把它写入stdout<br class="calibre12"/>    if re.search(regex, line):<br class="calibre12"/>        sys.stdout.write(line)<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><p class="calibre_15">然后对收到的行计数并输出计数结果：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/># line_count.py<br class="calibre12"/>import sys<br class="calibre12"/><br class="calibre12"/>count = 0<br class="calibre12"/>for line in sys.stdin:<br class="calibre12"/>    count += 1<br class="calibre12"/><br class="calibre12"/># 输出去向 sys.stdout<br class="calibre12"/>print count<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><p class="calibre_15">你可以用这种方法来计数文件中有多少行包含数字。在 Windows 中，你可以用：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>type SomeFile.txt | python egrep.py "[0-9]" | python line_count.py<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><p class="calibre_15">而在 Unix 系统中，你可以用：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>cat SomeFile.txt | python egrep.py "[0-9]" | python line_count.py<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><p class="calibre_15">“<tt class="calibre7">|</tt> ”运算符是个管道字符，它的意思是“使用左边命令的输出作为右边命令的输入”。可以使用这种方法精心设计数据处理的管道。</p><blockquote class="calibre_32"><img src="images/00100.jpg" class="calibre_10"/>
</blockquote><blockquote class="calibre_14">如果你使用的是 Windows，你可以在这行命令中去掉所包含的 <tt class="calibre7">python</tt> 部分：</blockquote><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>type SomeFile.txt | egrep.py "[0-9]" | line_count.py<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><blockquote class="calibre_33">如果你用 Unix 系统，这么做可能会需要多做一些额外工作。</blockquote><p class="calibre_">类似地，下面的这个脚本计算了单词的数量并给出了最常用的单词：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/># most_common_words.py<br class="calibre12"/>import sys<br class="calibre12"/>from collections import Counter<br class="calibre12"/><br class="calibre12"/># 传递单词的个数作为第一个参数<br class="calibre12"/>try:<br class="calibre12"/>    num_words = int(sys.argv[1])<br class="calibre12"/>except:<br class="calibre12"/>    print "usage: most_common_words.py num_words"<br class="calibre12"/>    sys.exit(1)   # 非零的exit代码表明有错误<br class="calibre12"/><br class="calibre12"/>counter = Counter(word.lower()                     # 小写的单词<br class="calibre12"/>                  for line in sys.stdin<br class="calibre12"/>                  for word in line.strip().split() # 用空格划分<br class="calibre12"/>                  if word)                         # 跳过空的 'words'<br class="calibre12"/><br class="calibre12"/>for word, count in counter.most_common(num_words):<br class="calibre12"/>    sys.stdout.write(str(count))<br class="calibre12"/>    sys.stdout.write("\t")<br class="calibre12"/>    sys.stdout.write(word)<br class="calibre12"/>    sys.stdout.write("\n")<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><p class="calibre_15">之后你可以对圣经文本使用这个脚本：</p><blockquote class="calibre_14"><span class="calibre11"><tt class="calibre7"><br class="calibre12"/>C:\DataScience&gt;type the_bible.txt | python most_common_words.py 10<br class="calibre12"/>64193   the<br class="calibre12"/>51380   and<br class="calibre12"/>34753   of<br class="calibre12"/>13643   to<br class="calibre12"/>12799   that<br class="calibre12"/>12560   in<br class="calibre12"/>10263   he<br class="calibre12"/>9840    shall<br class="calibre12"/>8987    unto<br class="calibre12"/>8836    for<br class="calibre12"/><br class="calibre12"/><br class="calibre12"/><br class="calibre12"/></tt></span></blockquote><blockquote class="calibre_33"><img src="images/00100.jpg" class="calibre_10"/> 　如果你是个 Unix 编程老手，你可能会很熟悉系统里许多内置的命令行工具（比如 <tt class="calibre7">egrep</tt> ），但你自己从零开始创建这些工具或许更好一些。毕竟，用到的时候刚好知道，总是好的。</blockquote><div class="mbp_pagebreak" id="calibre_pb_64"></div>
<div class="calibre5">本书由「<a href="https://epubw.com" class="calibre3">ePUBw.COM</a>」整理，<a href="https://epubw.com" class="calibre3">ePUBw.COM</a> 提供最新最全的优质电子书下载！！！</div></body></html>
